---
title: Agent-friendly task creation (crank task new + schema)
priority: 3
status: open
supervision: unsupervised
coding_agent: opencode
created: 2026-01-03
---

## Intent

AI coding agents can't use interactive TUIs. Make task creation agent-friendly with discoverable schema.

## Spec

### 1. Remove `app` field entirely
- Remove from `Task` struct in `model.rs`
- Remove from `TaskFrontmatter` in `store.rs`
- Remove `get_apps()` function from `store.rs`
- Update `task_template()` to not include `app`
- Remove `--app` / `-a` flag from CLI
- Update TUI display if it shows app

### 2. Rename `create` → `new` and redesign CLI
- `crank task new` with stdin → parse markdown, validate, save
- `crank task new --file <path>` → read file, validate, save
- `crank task new --title "..." [--priority N]` → quick creation (priority defaults to 3)
- `crank task new -i` → interactive mode (existing TUI prompts)
- Remove `--oc` flag entirely
- Keep `--edit` only for `-i` mode

### 3. Add validation with strict schema
- `title`: required, non-empty string
- `priority`: required, integer 1-5
- `status`: optional, defaults to "open"
- `depends_on`: optional, list of `{id, type}`
- `coding_agent`: optional, defaults to "opencode"
- `workflow`, `step_id`, `run`: optional (workflow system uses these)
- `created`: auto-set if missing
- Reject unknown fields with clear error messages

### 4. Add `crank task schema` command
- Prints task schema in readable format
- Generated from actual types/validation logic (not hardcoded)

### 5. Rewrite `crank agents.md`
- Generate content dynamically
- Include complete task schema by calling same code as `crank task schema`
- Document all commands
- Note that agents should run `crank agents.md` to understand crank
- Note that tasks are created with `crank task new`

### 6. Update related code
- `prompts.rs`: Remove app selection prompt
- `creator.rs`: Remove app logic, add stdin/file creation entry points
- `workflow.rs`: Update `run_create` → `run_new`
- Update tests that reference `app`

### Acceptable Output
- `crank task new` works for agents (stdin/file/flags)
- `crank task schema` prints discoverable schema
- `crank agents.md` includes schema from same source
- All tests pass, no `app` field anywhere
